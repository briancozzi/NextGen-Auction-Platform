@model EventWithAuctionItems
@inject IHttpContextAccessor _httpAccessor
@{
    var biddingRetunlUrl = _httpAccessor.HttpContext.Request.Cookies["BiddingReturnUrl"];
}
<div class="text-center">
    <h1>Event : @Model.EventName</h1>
    <h6>Start Date : @Model.EventStartDate</h6>
    <h6>End Date : @Model.EventEndDate</h6>

    <br />
    <table class="table table-responsive">
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Item Number</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.AuctionItems)
            {
                <tr>
                    <td>@item.ItemName</td>
                    <td>@item.ItemNumber</td>
                    <td>
                        <button class="btn btn-primary place-a-bid"
                                data-auction-id="@item.AuctionId"
                                data-auction-item-id="@item.AuctionItemId"
                                data-item-status="@item.ItemStatus">
                            Place a Bid
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts{
    <script>

        $(document).on("click", ".place-a-bid", function (e) {
            e.preventDefault();

            var _element = $(this);
            var auctionId = $(_element).attr("data-auction-id");
            var auctionItemId = $(_element).attr("data-auction-item-id");
            var itemStatus = $(_element).attr("data-item-status");
            $.ajax({
                url: "/Home/CreateBidderAndPlaceABid?auctionId=" + auctionId,
                type: "GET",
                dataType: "json",
                async: true,
                cache: false,
                success: function (response) {
                    if (!response.success) {
                        alert(response.message)
                    }
                    else {
                        debugger;

                        location.href = "/Home/GoToAuctionItem?auctionItemId=" + auctionItemId + "&itemStatus=" + itemStatus;
                    }

                },
                error: function (x) {
                    console.log("Error!!");
                }
            });

        });
    </script>
}


